/*!
 * Fine Uploader
 * Copyright 2013, Widen Enterprises, Inc. info@fineuploader.com
 * Version: 3.8.0
 * Homepage: http://fineuploader.com
 * Repository: git://github.com/Widen/fine-uploader.git
 * Licensed under GNU GPL v3, see LICENSE
 */ 
var fileUploader=function(e){"use strict";return{hide:function(){return e.style.display="none",this},attach:function(t,i){return e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i),function(){fileUploader(e).detach(t,i)}},detach:function(t,i){return e.removeEventListener?e.removeEventListener(t,i,!1):e.attachEvent&&e.detachEvent("on"+t,i),this},contains:function(t){return t?e===t?!0:e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e)):!1},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){return null!=t.opacity&&"string"!=typeof e.style.opacity&&"undefined"!=typeof e.filters&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),fileUploader.extend(e.style,t),this},hasClass:function(t){var i=new RegExp("(^| )"+t+"( |$)");return i.test(e.className)},addClass:function(t){return fileUploader(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var i=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(i," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t){var i,n=[];return e.querySelectorAll?e.querySelectorAll("."+t):(i=e.getElementsByTagName("*"),fileUploader.each(i,function(e,i){fileUploader(i).hasClass(t)&&n.push(i)}),n)},children:function(){for(var t=[],i=e.firstChild;i;)1===i.nodeType&&t.push(i),i=i.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return fileUploader(e).setText("")}}};fileUploader.log=function(e,t){"use strict";window.console&&(t&&"info"!==t?window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e):window.console.log(e))},fileUploader.isObject=function(e){"use strict";return e&&!e.nodeType&&"[object Object]"===Object.prototype.toString.call(e)},fileUploader.isFunction=function(e){"use strict";return"function"==typeof e},fileUploader.isArray=function(e){"use strict";return"[object Array]"===Object.prototype.toString.call(e)},fileUploader.isItemList=function(e){"use strict";return"[object DataTransferItemList]"===Object.prototype.toString.call(e)},fileUploader.isString=function(e){"use strict";return"[object String]"===Object.prototype.toString.call(e)},fileUploader.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},fileUploader.format=function(e){"use strict";var t=Array.prototype.slice.call(arguments,1),i=e;return fileUploader.each(t,function(e,t){i=i.replace(/{}/,t)}),i},fileUploader.isFile=function(e){"use strict";return window.File&&"[object File]"===Object.prototype.toString.call(e)},fileUploader.isFileList=function(e){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(e)},fileUploader.isFileOrInput=function(e){"use strict";return fileUploader.isFile(e)||fileUploader.isInput(e)},fileUploader.isInput=function(e){return window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(e)&&e.type&&"file"===e.type.toLowerCase()?!0:e.tagName&&"input"===e.tagName.toLowerCase()&&e.type&&"file"===e.type.toLowerCase()?!0:!1},fileUploader.isBlob=function(e){"use strict";return window.Blob&&"[object Blob]"===Object.prototype.toString.call(e)},fileUploader.isXhrUploadSupported=function(){"use strict";var e=document.createElement("input");return e.type="file",void 0!==e.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof(new XMLHttpRequest).upload},fileUploader.isFolderDropSupported=function(e){"use strict";return e.items&&e.items[0].webkitGetAsEntry},fileUploader.isFileChunkingSupported=function(){"use strict";return!fileUploader.android()&&fileUploader.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},fileUploader.extend=function(e,t,i){"use strict";return fileUploader.each(t,function(t,n){i&&fileUploader.isObject(n)?(void 0===e[t]&&(e[t]={}),fileUploader.extend(e[t],n,!0)):e[t]=n}),e},fileUploader.override=function(e,t){var i={},n=t(i);return fileUploader.each(n,function(t,n){void 0!==e[t]&&(i[t]=e[t]),e[t]=n}),e},fileUploader.indexOf=function(e,t,i){"use strict";if(e.indexOf)return e.indexOf(t,i);i=i||0;var n=e.length;for(0>i&&(i+=n);n>i;i+=1)if(e.hasOwnProperty(i)&&e[i]===t)return i;return-1},fileUploader.getUniqueId=function(){"use strict";return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})},fileUploader.ie=function(){"use strict";return-1!==navigator.userAgent.indexOf("MSIE")},fileUploader.ie7=function(){"use strict";return-1!==navigator.userAgent.indexOf("MSIE 7")},fileUploader.ie10=function(){"use strict";return-1!==navigator.userAgent.indexOf("MSIE 10")},fileUploader.safari=function(){"use strict";return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},fileUploader.chrome=function(){"use strict";return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},fileUploader.firefox=function(){"use strict";return-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},fileUploader.windows=function(){"use strict";return"Win32"===navigator.platform},fileUploader.android=function(){"use strict";return-1!==navigator.userAgent.toLowerCase().indexOf("android")},fileUploader.ios=function(){"use strict";return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},fileUploader.preventDefault=function(e){"use strict";e.preventDefault?e.preventDefault():e.returnValue=!1},fileUploader.toElement=function(){"use strict";var e=document.createElement("div");return function(t){e.innerHTML=t;var i=e.firstChild;return e.removeChild(i),i}}(),fileUploader.each=function(e,t){"use strict";var i,n;if(e)if(window.Storage&&e.constructor===window.Storage)for(i=0;i<e.length&&(n=t(e.key(i),e.getItem(e.key(i))),n!==!1);i++);else if(fileUploader.isArray(e)||fileUploader.isItemList(e))for(i=0;i<e.length&&(n=t(i,e[i]),n!==!1);i++);else if(fileUploader.isString(e))for(i=0;i<e.length&&(n=t(i,e.charAt(i)),n!==!1);i++);else for(i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&(n=t(i,e[i]),n===!1))break},fileUploader.bind=function(e,t){if(fileUploader.isFunction(e)){var i=Array.prototype.slice.call(arguments,2);return function(){var n=fileUploader.extend([],i);return arguments.length&&(n=n.concat(Array.prototype.slice.call(arguments))),e.apply(t,n)}}throw new Error("first parameter must be a function!")},fileUploader.obj2url=function(e,t,i){"use strict";var n=[],o="&",a=function(e,i){var o=t?/\[\]$/.test(t)?t:t+"["+i+"]":i;"undefined"!==o&&"undefined"!==i&&n.push("object"==typeof e?fileUploader.obj2url(e,o,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(o)+"="+encodeURIComponent(e()):encodeURIComponent(o)+"="+encodeURIComponent(e))};return!i&&t?(o=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",n.push(t),n.push(fileUploader.obj2url(e))):"[object Array]"===Object.prototype.toString.call(e)&&"undefined"!=typeof e?fileUploader.each(e,function(e,t){a(t,e)}):"undefined"!=typeof e&&null!==e&&"object"==typeof e?fileUploader.each(e,function(e,t){a(t,e)}):n.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?n.join(o):n.join(o).replace(/^&/,"").replace(/%20/g,"+")},fileUploader.obj2FormData=function(e,t,i){"use strict";return t||(t=new FormData),fileUploader.each(e,function(e,n){e=i?i+"["+e+"]":e,fileUploader.isObject(n)?fileUploader.obj2FormData(n,t,e):fileUploader.isFunction(n)?t.append(e,n()):t.append(e,n)}),t},fileUploader.obj2Inputs=function(e,t){"use strict";var i;return t||(t=document.createElement("form")),fileUploader.obj2FormData(e,{append:function(e,n){i=document.createElement("input"),i.setAttribute("name",e),i.setAttribute("value",n),t.appendChild(i)}}),t},fileUploader.setCookie=function(e,t,i){var n=new Date,o="";i&&(n.setTime(n.getTime()+24*i*60*60*1e3),o="; expires="+n.toGMTString()),document.cookie=e+"="+t+o+"; path=/"},fileUploader.getCookie=function(e){var t,i=e+"=",n=document.cookie.split(";");return fileUploader.each(n,function(e,n){for(var o=n;" "==o.charAt(0);)o=o.substring(1,o.length);return 0===o.indexOf(i)?(t=o.substring(i.length,o.length),!1):void 0}),t},fileUploader.getCookieNames=function(e){var t=document.cookie.split(";"),i=[];return fileUploader.each(t,function(t,n){n=fileUploader.trimStr(n);var o=n.indexOf("=");n.match(e)&&i.push(n.substr(0,o))}),i},fileUploader.deleteCookie=function(e){fileUploader.setCookie(e,"",-1)},fileUploader.areCookiesEnabled=function(){var e=1e5*Math.random(),t="fileUploaderCookieTest:"+e;return fileUploader.setCookie(t,1),fileUploader.getCookie(t)?(fileUploader.deleteCookie(t),!0):!1},fileUploader.parseJson=function(json){return window.JSON&&fileUploader.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},fileUploader.getExtension=function(e){var t=e.lastIndexOf(".")+1;return t>0?e.substr(t,e.length-t):void 0},fileUploader.DisposeSupport=function(){"use strict";var e=[];return{dispose:function(){var t;do t=e.shift(),t&&t();while(t)},attach:function(){var e=arguments;this.addDisposer(fileUploader(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}},fileUploader.version="3.8.0",fileUploader.supportedFeatures=function(){function e(){var e,t=!0;try{e=document.createElement("input"),e.type="file",fileUploader(e).hide(),e.disabled&&(t=!1)}catch(i){t=!1}return t}function t(){return fileUploader.chrome()&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)}function i(){return fileUploader.chrome()&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)}function n(){if(window.XMLHttpRequest){var e=new XMLHttpRequest;return void 0!==e.withCredentials}return!1}function o(){return void 0!==window.XDomainRequest}function a(){return n()?!0:o()}var r,l,s,d,p,u,c,f,h,m;return r=e(),l=r&&fileUploader.isXhrUploadSupported(),s=l&&t(),d=l&&fileUploader.isFileChunkingSupported(),p=l&&d&&fileUploader.areCookiesEnabled(),u=l&&i(),c=r&&(void 0!==window.postMessage||l),h=n(),f=o(),m=a(),{uploading:r,ajaxUploading:l,fileDrop:l,folderDrop:s,chunking:d,resume:p,uploadCustomHeaders:l,uploadNonMultipart:l,itemSizeValidation:l,uploadViaPaste:u,progressBar:l,uploadCors:c,deleteFileCorsXhr:h,deleteFileCorsXdr:f,deleteFileCors:m,canDetermineSize:l}}(),fileUploader.Promise=function(){"use strict";var e,t,i=[],n=[],o=[],a=0;return{then:function(o,r){return 0===a?(o&&i.push(o),r&&n.push(r)):-1===a&&r?r.apply(null,t):o&&o.apply(null,e),this},done:function(i){return 0===a?o.push(i):i.apply(null,void 0===t?e:t),this},success:function(){return a=1,e=arguments,i.length&&fileUploader.each(i,function(t,i){i.apply(null,e)}),o.length&&fileUploader.each(o,function(t,i){i.apply(null,e)}),this},failure:function(){return a=-1,t=arguments,n.length&&fileUploader.each(n,function(e,i){i.apply(null,t)}),o.length&&fileUploader.each(o,function(e,i){i.apply(null,t)}),this}}},fileUploader.isPromise=function(e){return e&&e.then&&e.done},fileUploader.UploadButton=function(e){"use strict";function t(){var e=document.createElement("input");return o.multiple&&e.setAttribute("multiple","multiple"),o.acceptFiles&&e.setAttribute("accept",o.acceptFiles),e.setAttribute("type","file"),e.setAttribute("name",o.name),fileUploader(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),o.element.appendChild(e),n.attach(e,"change",function(){o.onChange(e)}),n.attach(e,"mouseover",function(){fileUploader(o.element).addClass(o.hoverClass)}),n.attach(e,"mouseout",function(){fileUploader(o.element).removeClass(o.hoverClass)}),n.attach(e,"focus",function(){fileUploader(o.element).addClass(o.focusClass)}),n.attach(e,"blur",function(){fileUploader(o.element).removeClass(o.focusClass)}),window.attachEvent&&e.setAttribute("tabIndex","-1"),e}var i,n=new fileUploader.DisposeSupport,o={element:null,multiple:!1,acceptFiles:null,name:"fileUploaderfile",onChange:function(){},hoverClass:"fileUploader-upload-button-hover",focusClass:"fileUploader-upload-button-focus"};return fileUploader.extend(o,e),fileUploader(o.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),i=t(),{getInput:function(){return i},reset:function(){i.parentNode&&fileUploader(i).remove(),fileUploader(o.element).removeClass(o.focusClass),i=t()}}},fileUploader.PasteSupport=function(e){"use strict";function t(e){return e.type&&0===e.type.indexOf("image/")}function i(){fileUploader(o.targetElement).attach("paste",function(e){var i=e.clipboardData;i&&fileUploader.each(i.items,function(e,i){if(t(i)){var n=i.getAsFile();o.callbacks.pasteReceived(n)}})})}function n(){a&&a()}var o,a;return o={targetElement:null,callbacks:{log:function(){},pasteReceived:function(){}}},fileUploader.extend(o,e),i(),{reset:function(){n()}}},fileUploader.UploadData=function(e){function t(e){if(fileUploader.isArray(e)){var t=[];return fileUploader.each(e,function(e,i){t.push(a[r[i]])}),t}return a[r[e]]}function i(e){if(fileUploader.isArray(e)){var t=[];return fileUploader.each(e,function(e,i){t.push(a[l[i]])}),t}return a[l[e]]}function n(e){var t=[],i=[].concat(e);return fileUploader.each(i,function(e,i){var n=s[i];void 0!==n&&fileUploader.each(n,function(e,i){t.push(a[i])})}),t}var o,a=[],r={},l={},s={};return o={added:function(t){var i=e.getUuid(t),n=e.getName(t),o=e.getSize(t),d=fileUploader.status.SUBMITTING,p=a.push({id:t,name:n,originalName:n,uuid:i,size:o,status:d})-1;r[t]=p,l[i]=p,void 0===s[d]&&(s[d]=[]),s[d].push(p),e.onStatusChange(t,void 0,d)},retrieve:function(e){return fileUploader.isObject(e)&&a.length?void 0!==e.id?t(e.id):void 0!==e.uuid?i(e.uuid):e.status?n(e.status):void 0:fileUploader.extend([],a,!0)},reset:function(){a=[],r={},l={},s={}},setStatus:function(t,i){var n=r[t],o=a[n].status,l=fileUploader.indexOf(s[o],n);s[o].splice(l,1),a[n].status=i,void 0===s[i]&&(s[i]=[]),s[i].push(n),e.onStatusChange(t,o,i)},uuidChanged:function(e,t){var i=r[e],n=a[i].uuid;a[i].uuid=t,l[t]=i,delete l[n]},nameChanged:function(e,t){var i=r[e];a[i].name=t}}},fileUploader.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},fileUploader.basePublicApi={log:function(e,t){!this._options.debug||t&&"info"!==t?t&&"info"!==t&&fileUploader.log("[FineUploader "+fileUploader.version+"] "+e,t):fileUploader.log("[FineUploader "+fileUploader.version+"] "+e)},setParams:function(e,t){null==t?this._options.request.params=e:this._paramsStore.setParams(e,t)},setDeleteFileParams:function(e,t){null==t?this._options.deleteFile.params=e:this._deleteFileParamsStore.setParams(e,t)},setEndpoint:function(e,t){null==t?this._options.request.endpoint=e:this._endpointStore.setEndpoint(e,t)},getInProgress:function(){return this._filesInProgress.length},getNetUploads:function(){return this._netUploaded},uploadStoredFiles:function(){var e;if(0===this._storedIds.length)this._itemError("noFilesError");else for(;this._storedIds.length;)e=this._storedIds.shift(),this._filesInProgress.push(e),this._handler.upload(e)},clearStoredFiles:function(){this._storedIds=[]},retry:function(e){return this._onBeforeManualRetry(e)?(this._netUploadedOrQueued++,this._uploadData.setStatus(e,fileUploader.status.UPLOAD_RETRYING),this._handler.retry(e),!0):!1},cancel:function(e){this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;fileUploader.extend(e,this._storedIds),fileUploader.each(e,function(e,i){t.cancel(i)}),this._handler.cancelAll()},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._filesInProgress=[],this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._button.reset(),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._pasteHandler&&this._pasteHandler.reset()},addFiles:function(e,t,i){var n,o,a,r=this,l=[];if(e){for(fileUploader.isFileList(e)||(e=[].concat(e)),n=0;n<e.length;n+=1)if(o=e[n],fileUploader.isFileOrInput(o))if(fileUploader.isInput(o)&&fileUploader.supportedFeatures.ajaxUploading)for(a=0;a<o.files.length;a++)l.push(o.files[a]);else l.push(o);else r.log(o+" is not a File or INPUT element!  Ignoring!","warn");this.log("Received "+l.length+" files or inputs."),this._prepareItemsForUpload(l,t,i)}},addBlobs:function(e,t,i){if(e){var n=[].concat(e),o=[],a=this;fileUploader.each(n,function(e,t){fileUploader.isBlob(t)&&!fileUploader.isFileOrInput(t)?o.push({blob:t,name:a._options.blobs.defaultName}):fileUploader.isObject(t)&&t.blob&&t.name?o.push(t):a.log("addBlobs: entry at index "+e+" is not a Blob or a BlobData object","error")}),this._prepareItemsForUpload(o,t,i)}else this.log("undefined or non-array parameter passed into addBlobs","error")},getUuid:function(e){return this._handler.getUuid(e)},setUuid:function(e,t){return this._handler.setUuid(e,t)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._handler.getSize(e)},getName:function(e){return this._handler.getName(e)},setName:function(e,t){this._handler.setName(e,t),this._uploadData.nameChanged(e,t)},getFile:function(e){return this._handler.getFile(e)},deleteFile:function(e){this._onSubmitDelete(e)},setDeleteFileEndpoint:function(e,t){null==t?this._options.deleteFile.endpoint=e:this._deleteFileEndpointStore.setEndpoint(e,t)},doesExist:function(e){return this._handler.isValid(e)},getUploads:function(e){return this._uploadData.retrieve(e)}},fileUploader.basePrivateApi={_handleCheckedCallback:function(e){var t=this,i=e.callback();return fileUploader.isPromise(i)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),i.then(function(i){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(i)},function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)})):(i!==!1?e.onSuccess(i):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),i)},_createUploadButton:function(e){var t=this,i=new fileUploader.UploadButton({element:e,multiple:this._options.multiple&&fileUploader.supportedFeatures.ajaxUploading,acceptFiles:this._options.validation.acceptFiles,onChange:function(e){t._onInputChange(e)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});return this._disposeSupport.addDisposer(function(){i.dispose()}),i},_createUploadHandler:function(e,t){var i=this,n={debug:this._options.debug,maxConnections:this._options.maxConnections,inputName:this._options.request.inputName,cors:this._options.cors,demoMode:this._options.demoMode,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:function(e,t){i.log(e,t)},onProgress:function(e,t,n,o){i._onProgress(e,t,n,o),i._options.callbacks.onProgress(e,t,n,o)},onComplete:function(e,t,n,o){var a=i._onComplete(e,t,n,o);fileUploader.isPromise(a)?a.done(function(){i._options.callbacks.onComplete(e,t,n,o)}):i._options.callbacks.onComplete(e,t,n,o)},onCancel:function(e,t){return i._handleCheckedCallback({name:"onCancel",callback:fileUploader.bind(i._options.callbacks.onCancel,i,e,t),onSuccess:fileUploader.bind(i._onCancel,i,e,t),identifier:e})},onUpload:function(e,t){i._onUpload(e,t),i._options.callbacks.onUpload(e,t)},onUploadChunk:function(e,t,n){i._options.callbacks.onUploadChunk(e,t,n)},onResume:function(e,t,n){return i._options.callbacks.onResume(e,t,n)},onAutoRetry:function(e,t,n,o){return i._preventRetries[e]=n[i._options.retry.preventRetryResponseProperty],i._shouldAutoRetry(e,t,n)?(i._maybeParseAndSendUploadError(e,t,n,o),i._options.callbacks.onAutoRetry(e,t,i._autoRetries[e]+1),i._onBeforeAutoRetry(e,t),i._retryTimeouts[e]=setTimeout(function(){i._onAutoRetry(e,t,n)},1e3*i._options.retry.autoAttemptDelay),!0):!1},onUuidChanged:function(e,t){i._uploadData.uuidChanged(e,t)}};return fileUploader.each(this._options.request,function(e,t){n[e]=t}),e&&fileUploader.each(e,function(e,t){n[e]=t}),new fileUploader.UploadHandler(n,t)},_createDeleteHandler:function(){var e=this;return new fileUploader.DeleteFileAjaxRequestor({method:this._options.deleteFile.method,maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._options.deleteFile.customHeaders,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:function(t,i){e.log(t,i)},onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,i,n){e._onDeleteComplete(t,i,n),e._options.callbacks.onDeleteComplete(t,i,n)}})},_createPasteHandler:function(){var e=this;return new fileUploader.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:function(t,i){e.log(t,i)},pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:fileUploader.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:fileUploader.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createUploadDataTracker:function(){var e=this;return new fileUploader.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,i,n){e._onUploadStatusChange(t,i,n),e._options.callbacks.onStatusChange(t,i,n)}})},_onUploadStatusChange:function(){},_handlePasteSuccess:function(e,t){var i=e.type.split("/")[1],n=t;null==n&&(n=this._options.paste.defaultName),n+="."+i,this.addBlobs({name:n,blob:e})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e._filesInProgress.length){var t=t||window.event;return t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave}})},_onSubmit:function(e){this._netUploadedOrQueued++,this._options.autoUpload&&this._filesInProgress.push(e)},_onProgress:function(){},_onComplete:function(e,t,i,n){return i.success?(this._netUploaded++,this._uploadData.setStatus(e,fileUploader.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,fileUploader.status.UPLOAD_FAILED)),this._removeFromFilesInProgress(e),this._maybeParseAndSendUploadError(e,t,i,n),i.success?!0:!1},_onCancel:function(e){this._netUploadedOrQueued--,this._removeFromFilesInProgress(e),clearTimeout(this._retryTimeouts[e]);var t=fileUploader.indexOf(this._storedIds,e);!this._options.autoUpload&&t>=0&&this._storedIds.splice(t,1),this._uploadData.setStatus(e,fileUploader.status.CANCELED)},_isDeletePossible:function(){return this._options.deleteFile.enabled?this._options.cors.expected?fileUploader.supportedFeatures.deleteFileCorsXhr?!0:fileUploader.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr?!0:!1:!0:!1},_onSubmitDelete:function(e,t,i){var n,o=this.getUuid(e);return t&&(n=fileUploader.bind(t,this,e,o,i)),this._isDeletePossible()?this._handleCheckedCallback({name:"onSubmitDelete",callback:fileUploader.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:n||fileUploader.bind(this._deleteHandler.sendDelete,this,e,o,i),identifier:e}):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onDelete:function(e){this._uploadData.setStatus(e,fileUploader.status.DELETING)},_onDeleteComplete:function(e,t,i){var n=this._handler.getName(e);i?(this._uploadData.setStatus(e,fileUploader.status.DELETE_FAILED),this.log("Delete request for '"+n+"' has failed.","error"),void 0===t.withCredentials?this._options.callbacks.onError(e,n,"Delete request failed",t):this._options.callbacks.onError(e,n,"Delete request failed with response code "+t.status,t)):(this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,fileUploader.status.DELETED),this.log("Delete request for '"+n+"' has succeeded."))},_removeFromFilesInProgress:function(e){var t=fileUploader.indexOf(this._filesInProgress,e);t>=0&&this._filesInProgress.splice(t,1)},_onUpload:function(e){this._uploadData.setStatus(e,fileUploader.status.UPLOADING)},_onInputChange:function(e){this.addFiles(fileUploader.supportedFeatures.ajaxUploading?e.files:e),this._button.reset()},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onAutoRetry:function(e,t){this.log("Retrying "+t+"..."),this._autoRetries[e]++,this._uploadData.setStatus(e,fileUploader.status.UPLOAD_RETRYING),this._handler.retry(e)},_shouldAutoRetry:function(e){return!this._preventRetries[e]&&this._options.retry.enableAuto?(void 0===this._autoRetries[e]&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts):!1},_onBeforeManualRetry:function(e){var t=this._options.validation.itemLimit;if(this._preventRetries[e])return this.log("Retries are forbidden for id "+e,"warn"),!1;if(this._handler.isValid(e)){var i=this._handler.getName(e);return this._options.callbacks.onManualRetry(e,i)===!1?!1:t>0&&this._netUploadedOrQueued+1>t?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+i+"' (id: "+e+")..."),this._filesInProgress.push(e),!0)}return this.log("'"+e+"' is not a valid file ID","error"),!1},_maybeParseAndSendUploadError:function(e,t,i,n){if(!i.success)if(n&&200!==n.status&&!i.error)this._options.callbacks.onError(e,t,"XHR returned response code "+n.status,n);else{var o=i.error?i.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,o,n)}},_prepareItemsForUpload:function(e,t,i){var n=this._getValidationDescriptors(e);this._handleCheckedCallback({name:"onValidateBatch",callback:fileUploader.bind(this._options.callbacks.onValidateBatch,this,n),onSuccess:fileUploader.bind(this._onValidateBatchCallbackSuccess,this,n,e,t,i),identifier:"batch validation"})},_upload:function(e,t,i){var n=this._handler.add(e),o=this._handler.getName(n);this._uploadData.added(n),t&&this.setParams(t,n),i&&this.setEndpoint(i,n),this._handleCheckedCallback({name:"onSubmit",callback:fileUploader.bind(this._options.callbacks.onSubmit,this,n,o),onSuccess:fileUploader.bind(this._onSubmitCallbackSuccess,this,n,o),onFailure:fileUploader.bind(this._fileOrBlobRejected,this,n,o),identifier:n})},_onSubmitCallbackSuccess:function(e){this._uploadData.setStatus(e,fileUploader.status.SUBMITTED),this._onSubmit.apply(this,arguments),this._onSubmitted.apply(this,arguments),this._options.callbacks.onSubmitted.apply(this,arguments),this._options.autoUpload?this._handler.upload(e)||this._uploadData.setStatus(e,fileUploader.status.QUEUED):this._storeForLater(e)},_onSubmitted:function(){},_storeForLater:function(e){this._storedIds.push(e)},_onValidateBatchCallbackSuccess:function(e,t,i,n){var o,a=this._options.validation.itemLimit,r=this._netUploadedOrQueued+e.length;0===a||a>=r?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:fileUploader.bind(this._options.callbacks.onValidate,this,t[0]),onSuccess:fileUploader.bind(this._onValidateCallbackSuccess,this,t,0,i,n),onFailure:fileUploader.bind(this._onValidateCallbackFailure,this,t,0,i,n),identifier:"Item '"+t[0].name+"', size: "+t[0].size}):this._itemError("noFilesError"):(o=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,r).replace(/\{itemLimit\}/g,a),this._batchError(o))},_onValidateCallbackSuccess:function(e,t,i,n){var o=t+1,a=this._getValidationDescriptor(e[t]),r=!1;this._validateFileOrBlobData(e[t],a)&&(r=!0,this._upload(e[t],i,n)),this._maybeProcessNextItemAfterOnValidateCallback(r,e,o,i,n)},_onValidateCallbackFailure:function(e,t,i,n){var o=t+1;this._fileOrBlobRejected(void 0,e[0].name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,o,i,n)},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,i,n,o){var a=this;t.length>i&&(e||!this._options.validation.stopOnFirstInvalidFile)&&setTimeout(function(){var e=a._getValidationDescriptor(t[i]);a._handleCheckedCallback({name:"onValidate",callback:fileUploader.bind(a._options.callbacks.onValidate,a,t[i]),onSuccess:fileUploader.bind(a._onValidateCallbackSuccess,a,t,i,n,o),onFailure:fileUploader.bind(a._onValidateCallbackFailure,a,t,i,n,o),identifier:"Item '"+e.name+"', size: "+e.size})},0)},_validateFileOrBlobData:function(e,t){var i=t.name,n=t.size,o=!0;return this._options.callbacks.onValidate(t)===!1&&(o=!1),fileUploader.isFileOrInput(e)&&!this._isAllowedExtension(i)?(this._itemError("typeError",i),o=!1):0===n?(this._itemError("emptyError",i),o=!1):n&&this._options.validation.sizeLimit&&n>this._options.validation.sizeLimit?(this._itemError("sizeError",i),o=!1):n&&n<this._options.validation.minSizeLimit&&(this._itemError("minSizeError",i),o=!1),o||this._fileOrBlobRejected(void 0,i),o},_fileOrBlobRejected:function(e){void 0!==e&&this._uploadData.setStatus(e,fileUploader.status.REJECTED)},_itemError:function(e,t){function i(e,t){a=a.replace(e,t)}var n,o,a=this._options.messages[e],r=[],l=[].concat(t),s=l[0];return fileUploader.each(this._options.validation.allowedExtensions,function(e,t){fileUploader.isString(t)&&r.push(t)}),n=r.join(", ").toLowerCase(),i("{file}",this._options.formatFileName(s)),i("{extensions}",n),i("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit)),i("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit)),o=a.match(/(\{\w+\})/g),null!==o&&fileUploader.each(o,function(e,t){i(t,l[e])}),this._options.callbacks.onError(null,s,a,void 0),a},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_isAllowedExtension:function(e){var t=this._options.validation.allowedExtensions,i=!1;return t.length?(fileUploader.each(t,function(t,n){if(fileUploader.isString(n)){var o=new RegExp("\\."+n+"$","i");if(null!=e.match(o))return i=!0,!1}}),i):!0},_formatSize:function(e){var t=-1;do e/=1e3,t++;while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_wrapCallbacks:function(){var e,t;e=this,t=function(t,i,n){try{return i.apply(e,n)}catch(o){e.log("Caught exception in '"+t+"' callback - "+o.message,"error")}};for(var i in this._options.callbacks)!function(){var n,o;n=i,o=e._options.callbacks[n],e._options.callbacks[n]=function(){return t(n,o,arguments)}}()},_parseFileOrBlobDataName:function(e){var t;return t=fileUploader.isFileOrInput(e)?e.value?e.value.replace(/.*(\/|\\)/,""):null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name:e.name},_parseFileOrBlobDataSize:function(e){var t;return fileUploader.isFileOrInput(e)?e.value||(t=null!==e.fileSize&&void 0!==e.fileSize?e.fileSize:e.size):t=e.blob.size,t},_getValidationDescriptor:function(e){var t,i,n;return n={},t=this._parseFileOrBlobDataName(e),i=this._parseFileOrBlobDataSize(e),n.name=t,void 0!==i&&(n.size=i),n},_getValidationDescriptors:function(e){var t=this,i=[];return fileUploader.each(e,function(e,n){i.push(t._getValidationDescriptor(n))}),i},_createParamsStore:function(e){var t={},i=this;return{setParams:function(e,i){var n={};fileUploader.extend(n,e),t[i]=n},getParams:function(n){var o={};return null!=n&&t[n]?fileUploader.extend(o,t[n]):fileUploader.extend(o,i._options[e].params),o},remove:function(e){return delete t[e]},reset:function(){t={}}}},_createEndpointStore:function(e){var t={},i=this;return{setEndpoint:function(e,i){t[i]=e},getEndpoint:function(n){return null!=n&&t[n]?t[n]:i._options[e].endpoint},remove:function(e){return delete t[e]},reset:function(){t={}}}},_handleCameraAccess:function(){this._options.camera.ios&&fileUploader.ios()&&(this._options.multiple=!1,null===this._options.validation.acceptFiles?this._options.validation.acceptFiles="image/*;capture=camera":this._options.validation.acceptFiles+=",image/*;capture=camera")
}},fileUploader.FineUploaderBasic=function(e){this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpoint:"/server/upload",params:{},paramsInBody:!0,customHeaders:{},forceMultipart:!0,inputName:"fileUploaderfile",uuidName:"fileUploaderuuid",totalFileSizeName:"fileUploadertotalfilesize",filenameParam:"fileUploaderfilename"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null},callbacks:{onSubmit:function(){},onSubmitted:function(){},onComplete:function(){},onCancel:function(){},onUpload:function(){},onUploadChunk:function(){},onResume:function(){},onProgress:function(){},onError:function(){},onAutoRetry:function(){},onManualRetry:function(){},onValidateBatch:function(){},onValidate:function(){},onSubmitDelete:function(){},onDelete:function(){},onDeleteComplete:function(){},onPasteReceived:function(){},onStatusChange:function(){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"fileUploader-upload-button-hover",buttonFocus:"fileUploader-upload-button-focus"},chunking:{enabled:!1,partSize:2e6,paramNames:{partIndex:"fileUploaderpartindex",partByteOffset:"fileUploaderpartbyteoffset",chunkSize:"fileUploaderchunksize",totalFileSize:"fileUploadertotalfilesize",totalParts:"fileUploadertotalparts"}},resume:{enabled:!1,id:null,cookiesExpireIn:7,paramNames:{resuming:"fileUploaderresume"}},formatFileName:function(e){return void 0!==e&&e.length>33&&(e=e.slice(0,19)+"..."+e.slice(-14)),e},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1}},fileUploader.extend(this._options,e,!0),this._handleCameraAccess(),this._wrapCallbacks(),this._disposeSupport=new fileUploader.DisposeSupport,this._filesInProgress=[],this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._paramsStore=this._createParamsStore("request"),this._deleteFileParamsStore=this._createParamsStore("deleteFile"),this._endpointStore=this._createEndpointStore("request"),this._deleteFileEndpointStore=this._createEndpointStore("deleteFile"),this._handler=this._createUploadHandler(),this._deleteHandler=this._createDeleteHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._options.paste.targetElement&&(this._pasteHandler=this._createPasteHandler()),this._preventLeaveInProgress()},fileUploader.FineUploaderBasic.prototype=fileUploader.basePublicApi,fileUploader.extend(fileUploader.FineUploaderBasic.prototype,fileUploader.basePrivateApi),fileUploader.DragAndDrop=function(e){"use strict";function t(e){l.callbacks.dropLog("Grabbed "+e.length+" dropped files."),s.dropDisabled(!1),l.callbacks.processingDroppedFilesComplete(e)}function i(e){var t,n=new fileUploader.Promise;return e.isFile?e.file(function(e){d.push(e),n.success()},function(t){l.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+t.code+".","error"),n.failure()}):e.isDirectory&&(t=e.createReader(),t.readEntries(function(e){var t=e.length;fileUploader.each(e,function(e,o){i(o).done(function(){t-=1,0===t&&n.success()})}),e.length||n.success()},function(t){l.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+t.code+".","error"),n.failure()})),n}function n(e){var t=[],n=new fileUploader.Promise;return l.callbacks.processingDroppedFiles(),s.dropDisabled(!0),e.files.length>1&&!l.allowMultipleItems?(l.callbacks.processingDroppedFilesComplete([]),l.callbacks.dropError("tooManyFilesError",""),s.dropDisabled(!1),n.failure()):(d=[],fileUploader.isFolderDropSupported(e)?fileUploader.each(e.items,function(e,o){var a=o.webkitGetAsEntry();a&&(a.isFile?d.push(o.getAsFile()):t.push(i(a).done(function(){t.pop(),0===t.length&&n.success()})))}):d=e.files,0===t.length&&n.success()),n}function o(e){s=new fileUploader.UploadDropZone({element:e,onEnter:function(t){fileUploader(e).addClass(l.classes.dropActive),t.stopPropagation()},onLeaveNotDescendants:function(){fileUploader(e).removeClass(l.classes.dropActive)},onDrop:function(i){l.hideDropZonesBeforeEnter&&fileUploader(e).hide(),fileUploader(e).removeClass(l.classes.dropActive),n(i.dataTransfer).done(function(){t(d)})}}),p.addDisposer(function(){s.dispose()}),l.hideDropZonesBeforeEnter&&fileUploader(e).hide()}function a(e){var t;return fileUploader.each(e.dataTransfer.types,function(e,i){return"Files"===i?(t=!0,!1):void 0}),t}function r(){var e=l.dropZoneElements;fileUploader.each(e,function(e,t){o(t)}),!e.length||fileUploader.ie()&&!fileUploader.ie10()||p.attach(document,"dragenter",function(t){!s.dropDisabled()&&a(t)&&fileUploader.each(e,function(e,t){fileUploader(t).css({display:"block"})})}),p.attach(document,"dragleave",function(t){l.hideDropZonesBeforeEnter&&fileUploader.FineUploader.prototype._leaving_document_out(t)&&fileUploader.each(e,function(e,t){fileUploader(t).hide()})}),p.attach(document,"drop",function(t){l.hideDropZonesBeforeEnter&&fileUploader.each(e,function(e,t){fileUploader(t).hide()}),t.preventDefault()})}var l,s,d=[],p=new fileUploader.DisposeSupport;return l={dropZoneElements:[],hideDropZonesBeforeEnter:!1,allowMultipleItems:!0,classes:{dropActive:null},callbacks:new fileUploader.DragAndDrop.callbacks},fileUploader.extend(l,e,!0),r(),{setupExtraDropzone:function(e){l.dropZoneElements.push(e),o(e)},removeDropzone:function(e){var t,i=l.dropZoneElements;for(t in i)if(i[t]===e)return i.splice(t,1)},dispose:function(){p.dispose(),s.dispose()}}},fileUploader.DragAndDrop.callbacks=function(){return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(){},dropError:function(e,t){fileUploader.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){fileUploader.log(e,t)}}},fileUploader.UploadDropZone=function(e){"use strict";function t(){return fileUploader.safari()||fileUploader.firefox()&&fileUploader.windows()}function i(){d||(t?p.attach(document,"dragover",function(e){e.preventDefault()}):p.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),d=!0)}function n(e){if(fileUploader.ie()&&!fileUploader.ie10())return!1;var t,i=e.dataTransfer,n=fileUploader.safari();return t=fileUploader.ie10()?!0:"none"!==i.effectAllowed,i&&t&&(i.files||!n&&i.types.contains&&i.types.contains("Files"))}function o(e){return void 0!==e&&(s=e),s}function a(){p.attach(l,"dragover",function(e){if(n(e)){var t=fileUploader.ie()?null:e.dataTransfer.effectAllowed;e.dataTransfer.dropEffect="move"===t||"linkMove"===t?"move":"copy",e.stopPropagation(),e.preventDefault()}}),p.attach(l,"dragenter",function(e){if(!o()){if(!n(e))return;r.onEnter(e)}}),p.attach(l,"dragleave",function(e){if(n(e)){r.onLeave(e);var t=document.elementFromPoint(e.clientX,e.clientY);fileUploader(this).contains(t)||r.onLeaveNotDescendants(e)}}),p.attach(l,"drop",function(e){if(!o()){if(!n(e))return;e.preventDefault(),r.onDrop(e)}})}var r,l,s,d,p=new fileUploader.DisposeSupport;return r={element:null,onEnter:function(){},onLeave:function(){},onLeaveNotDescendants:function(){},onDrop:function(){}},fileUploader.extend(r,e),l=r.element,i(),a(),{dropDisabled:function(e){return o(e)},dispose:function(){p.dispose()}}},fileUploader.uiPublicApi={clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments),this._listElement.innerHTML=""},addExtraDropzone:function(e){this._dnd.setupExtraDropzone(e)},removeExtraDropzone:function(e){return this._dnd.removeDropzone(e)},getItemByFileId:function(e){for(var t=this._listElement.firstChild;t;){if(t.fileUploaderFileId==e)return t;t=t.nextSibling}},reset:function(){this._parent.prototype.reset.apply(this,arguments),this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._options.button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._dnd.dispose(),this._dnd=this._setupDragAndDrop(),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0}},fileUploader.uiPrivateApi={_removeFileItem:function(e){var t=this.getItemByFileId(e);fileUploader(t).remove()},_setupDragAndDrop:function(){var e,t=this,i=this._find(this._element,"dropProcessing"),n=this._options.dragAndDrop.extraDropzones;return e=function(e){e.preventDefault()},this._options.dragAndDrop.disableDefaultDropzone||n.push(this._find(this._options.element,"drop")),new fileUploader.DragAndDrop({dropZoneElements:n,hideDropZonesBeforeEnter:this._options.dragAndDrop.hideDropzones,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){var n=t._button.getInput();fileUploader(i).css({display:"block"}),fileUploader(n).attach("click",e)},processingDroppedFilesComplete:function(n){var o=t._button.getInput();fileUploader(i).hide(),fileUploader(o).detach("click",e),n&&t.addFiles(n)},dropError:function(e,i){t._itemError(e,i)},dropLog:function(e,i){t.log(e,i)}}})},_bindDeleteRetryOrCancelClickEvent:function(){var e=this;return new fileUploader.DeleteRetryOrCancelClickHandler({listElement:this._listElement,classes:this._classes,log:function(t,i){e.log(t,i)},onDeleteFile:function(t){e.deleteFile(t)},onCancel:function(t){e.cancel(t)},onRetry:function(t){var i=e.getItemByFileId(t);fileUploader(i).removeClass(e._classes.retryable),e.retry(t)},onGetName:function(t){return e.getName(t)}})},_isEditFilenameEnabled:function(){return this._options.editFilename.enabled&&!this._options.autoUpload},_filenameEditHandler:function(){var e=this;return{listElement:this._listElement,classes:this._classes,log:function(t,i){e.log(t,i)},onGetUploadStatus:function(t){return e.getUploads({id:t}).status},onGetName:function(t){return e.getName(t)},onSetName:function(t,i){var n=e.getItemByFileId(t),o=fileUploader(e._find(n,"file")),a=e._options.formatFileName(i);o.setText(a),e.setName(t,i)},onGetInput:function(t){return e._find(t,"editFilenameInput")},onEditingStatusChange:function(t,i){var n=e.getItemByFileId(t),o=fileUploader(e._find(n,"editFilenameInput")),a=fileUploader(e._find(n,"file")),r=fileUploader(e._find(n,"editNameIcon")),l=e._classes.editable;i?(o.addClass("fileUploader-editing"),a.hide(),r.removeClass(l)):(o.removeClass("fileUploader-editing"),a.css({display:""}),r.addClass(l)),fileUploader(n).addClass("fileUploader-temp").removeClass("fileUploader-temp")}}},_onUploadStatusChange:function(e,t,i){if(this._isEditFilenameEnabled()){var n,o,a=this.getItemByFileId(e),r=this._classes.editable;a&&i!==fileUploader.status.SUBMITTED&&(n=fileUploader(this._find(a,"file")),o=fileUploader(this._find(a,"editNameIcon")),n.removeClass(r),o.removeClass(r))}},_bindFilenameInputFocusInEvent:function(){var e=fileUploader.extend({},this._filenameEditHandler());return new fileUploader.FilenameInputFocusInHandler(e)},_bindFilenameInputFocusEvent:function(){var e=fileUploader.extend({},this._filenameEditHandler());return new fileUploader.FilenameInputFocusHandler(e)},_bindFilenameClickEvent:function(){var e=fileUploader.extend({},this._filenameEditHandler());return new fileUploader.FilenameClickHandler(e)},_leaving_document_out:function(e){return(fileUploader.chrome()||fileUploader.safari()&&fileUploader.windows())&&0==e.clientX&&0==e.clientY||fileUploader.firefox()&&!e.relatedTarget},_storeForLater:function(e){this._parent.prototype._storeForLater.apply(this,arguments);var t=this.getItemByFileId(e);fileUploader(this._find(t,"spinner")).hide()},_find:function(e,t){var i=fileUploader(e).getByClass(this._options.classes[t])[0];if(!i)throw new Error("element not found "+t);return i},_onSubmit:function(e,t){this._parent.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onSubmitted:function(e){if(this._isEditFilenameEnabled()){var t=this.getItemByFileId(e),i=fileUploader(this._find(t,"file")),n=fileUploader(this._find(t,"editNameIcon")),o=this._classes.editable;i.addClass(o),n.addClass(o),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._find(t,"editFilenameInput"))}},_onProgress:function(e,t,i,n){this._parent.prototype._onProgress.apply(this,arguments);var o,a,r,l;o=this.getItemByFileId(e),a=this._find(o,"progressBar"),r=Math.round(i/n*100),i===n?(l=this._find(o,"cancel"),fileUploader(l).hide(),fileUploader(a).hide(),fileUploader(this._find(o,"statusText")).setText(this._options.text.waitingForResponse),this._displayFileSize(e)):(this._displayFileSize(e,i,n),fileUploader(a).css({display:"block"})),fileUploader(a).css({width:r+"%"})},_onComplete:function(e,t,i){function n(t){var i=a.getItemByFileId(e);fileUploader(a._find(i,"statusText")).clearText(),fileUploader(i).removeClass(a._classes.retrying),fileUploader(a._find(i,"progressBar")).hide(),(!a._options.disableCancelForFormUploads||fileUploader.supportedFeatures.ajaxUploading)&&fileUploader(a._find(i,"cancel")).hide(),fileUploader(a._find(i,"spinner")).hide(),t.success?(a._isDeletePossible()&&a._showDeleteLink(e),fileUploader(i).addClass(a._classes.success),a._classes.successIcon&&(a._find(i,"finished").style.display="inline-block",fileUploader(i).addClass(a._classes.successIcon))):(fileUploader(i).addClass(a._classes.fail),a._classes.failIcon&&(a._find(i,"finished").style.display="inline-block",fileUploader(i).addClass(a._classes.failIcon)),a._options.retry.showButton&&!a._preventRetries[e]&&fileUploader(i).addClass(a._classes.retryable),a._controlFailureTextDisplay(i,t))}var o=this._parent.prototype._onComplete.apply(this,arguments),a=this;return fileUploader.isPromise(o)?o.done(function(e){n(e)}):n(i),o},_onUpload:function(e){var t=this._parent.prototype._onUpload.apply(this,arguments);return this._showSpinner(e),t},_onCancel:function(e){this._parent.prototype._onCancel.apply(this,arguments),this._removeFileItem(e)},_onBeforeAutoRetry:function(e){var t,i,n,o,a,r;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments),t=this.getItemByFileId(e),i=this._find(t,"progressBar"),this._showCancelLink(t),i.style.width=0,fileUploader(i).hide(),this._options.retry.showAutoRetryNote&&(n=this._find(t,"statusText"),o=this._autoRetries[e]+1,a=this._options.retry.maxAutoAttempts,r=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,o),r=r.replace(/\{maxAuto\}/g,a),fileUploader(n).setText(r),1===o&&fileUploader(t).addClass(this._classes.retrying))},_onBeforeManualRetry:function(e){var t=this.getItemByFileId(e);return this._parent.prototype._onBeforeManualRetry.apply(this,arguments)?(this._find(t,"progressBar").style.width=0,fileUploader(t).removeClass(this._classes.fail),fileUploader(this._find(t,"statusText")).clearText(),this._showSpinner(e),this._showCancelLink(t),!0):(fileUploader(t).addClass(this._classes.retryable),!1)},_onSubmitDelete:function(e){var t=fileUploader.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,e,t)},_onSubmitDeleteSuccess:function(){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(e,t,i){this._parent.prototype._onDeleteComplete.apply(this,arguments);var n=this.getItemByFileId(e),o=this._find(n,"spinner"),a=this._find(n,"statusText");fileUploader(o).hide(),i?(fileUploader(a).setText(this._options.deleteFile.deletingFailedText),this._showDeleteLink(e)):this._removeFileItem(e)},_sendDeleteRequest:function(e){var t=this.getItemByFileId(e),i=this._find(t,"deleteButton"),n=this._find(t,"statusText");fileUploader(i).hide(),this._showSpinner(e),fileUploader(n).setText(this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(e){var t=this._handler.getName(e),i=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,t),n=(this.getUuid(e),arguments),o=this;this._options.showConfirm(i,function(){o._sendDeleteRequest.apply(o,n)})},_addToList:function(e,t){var i=fileUploader.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!fileUploader.supportedFeatures.ajaxUploading){var n=this._find(i,"cancel");fileUploader(n).remove()}i.fileUploaderFileId=e;var o=this._find(i,"file");fileUploader(o).setText(this._options.formatFileName(t)),fileUploader(this._find(i,"size")).hide(),this._options.multiple||(this._handler.cancelAll(),this._clearList()),this._options.display.prependFiles?this._prependItem(i):this._listElement.appendChild(i),this._filesInBatchAddedToUi+=1,this._options.display.fileSizeOnSubmit&&fileUploader.supportedFeatures.ajaxUploading&&this._displayFileSize(e)},_prependItem:function(e){var t=this._listElement,i=t.firstChild;this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(i=fileUploader(t).children()[this._filesInBatchAddedToUi-1].nextSibling),t.insertBefore(e,i)},_clearList:function(){this._listElement.innerHTML="",this.clearStoredFiles()},_displayFileSize:function(e,t,i){var n=this.getItemByFileId(e),o=this.getSize(e),a=this._formatSize(o),r=this._find(n,"size");void 0!==t&&void 0!==i&&(a=this._formatProgress(t,i)),fileUploader(r).css({display:"inline"}),fileUploader(r).setText(a)},_formatProgress:function(e,t){function i(e,t){n=n.replace(e,t)}var n=this._options.text.formatProgress;return i("{percent}",Math.round(e/t*100)),i("{total_size}",this._formatSize(t)),n},_controlFailureTextDisplay:function(e,t){var i,n,o,a,r;i=this._options.failedUploadTextDisplay.mode,n=this._options.failedUploadTextDisplay.maxChars,o=this._options.failedUploadTextDisplay.responseProperty,"custom"===i?(a=t[o],a?a.length>n&&(r=a.substring(0,n)+"..."):(a=this._options.text.failUpload,this.log("'"+o+"' is not a valid property on the server response.","warn")),fileUploader(this._find(e,"statusText")).setText(r||a),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(e,a)):"default"===i?fileUploader(this._find(e,"statusText")).setText(this._options.text.failUpload):"none"!==i&&this.log("failedUploadTextDisplay.mode value of '"+i+"' is not valid","warn")},_showTooltip:function(e,t){e.title=t},_showSpinner:function(e){var t=this.getItemByFileId(e),i=this._find(t,"spinner");i.style.display="inline-block"},_showCancelLink:function(e){if(!this._options.disableCancelForFormUploads||fileUploader.supportedFeatures.ajaxUploading){var t=this._find(e,"cancel");fileUploader(t).css({display:"inline"})}},_showDeleteLink:function(e){var t=this.getItemByFileId(e),i=this._find(t,"deleteButton");fileUploader(i).css({display:"inline"})},_itemError:function(){var e=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(e)},_batchError:function(e){this._parent.prototype._batchError.apply(this,arguments),this._options.showMessage(e)},_setupPastePrompt:function(){var e=this;this._options.callbacks.onPasteReceived=function(){var t=e._options.paste.namePromptMessage,i=e._options.paste.defaultName;return e._options.showPrompt(t,i)}},_fileOrBlobRejected:function(){this._totalFilesInBatch-=1,this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(e){this._totalFilesInBatch=e.length,this._filesInBatchAddedToUi=0,this._parent.prototype._prepareItemsForUpload.apply(this,arguments)}},fileUploader.FineUploader=function(e,t){this._parent=t?fileUploader[t].FineUploaderBasic:fileUploader.FineUploaderBasic,this._parent.apply(this,arguments),fileUploader.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:!0,disableDefaultDropzone:!1},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",deleteButton:"Delete",failUpload:"Upload failed",dragZone:"Drop files here to upload",dropProcessing:"Processing dropped files...",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="fileUploader-uploader">'+(this._options.dragAndDrop&&this._options.dragAndDrop.disableDefaultDropzone?"":'<div class="fileUploader-upload-drop-area"><span>{dragZoneText}</span></div>')+(this._options.button?"":'<div class="fileUploader-upload-button"><div>{uploadButtonText}</div></div>')+'<span class="fileUploader-drop-processing"><span>{dropProcessingText}</span><span class="fileUploader-drop-processing-spinner"></span></span>'+(this._options.listElement?"":'<ul class="fileUploader-upload-list"></ul>')+"</div>",fileTemplate:'<li><div class="fileUploader-progress-bar"></div><span class="fileUploader-upload-spinner"></span><span class="fileUploader-upload-finished"></span>'+(this._options.editFilename&&this._options.editFilename.enabled?'<span class="fileUploader-edit-filename-icon"></span>':"")+'<span class="fileUploader-upload-file"></span>'+(this._options.editFilename&&this._options.editFilename.enabled?'<input class="fileUploader-edit-filename" tabindex="0" type="text">':"")+'<span class="fileUploader-upload-size"></span><a class="fileUploader-upload-cancel" href="#">{cancelButtonText}</a><a class="fileUploader-upload-retry" href="#">{retryButtonText}</a><a class="fileUploader-upload-delete" href="#">{deleteButtonText}</a><span class="fileUploader-upload-status-text">{statusText}</span></li>',classes:{button:"fileUploader-upload-button",drop:"fileUploader-upload-drop-area",dropActive:"fileUploader-upload-drop-area-active",list:"fileUploader-upload-list",progressBar:"fileUploader-progress-bar",file:"fileUploader-upload-file",spinner:"fileUploader-upload-spinner",finished:"fileUploader-upload-finished",retrying:"fileUploader-upload-retrying",retryable:"fileUploader-upload-retryable",size:"fileUploader-upload-size",cancel:"fileUploader-upload-cancel",deleteButton:"fileUploader-upload-delete",retry:"fileUploader-upload-retry",statusText:"fileUploader-upload-status-text",editFilenameInput:"fileUploader-edit-filename",success:"fileUploader-upload-success",fail:"fileUploader-upload-fail",successIcon:null,failIcon:null,editNameIcon:"fileUploader-edit-filename-icon",editable:"fileUploader-editable",dropProcessing:"fileUploader-drop-processing",dropProcessingSpinner:"fileUploader-drop-processing-spinner"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:!1},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},editFilename:{enabled:!1},showMessage:function(e){setTimeout(function(){window.alert(e)},0)},showConfirm:function(e,t,i){setTimeout(function(){var n=window.confirm(e);n?t():i&&i()},0)},showPrompt:function(e,t){var i=new fileUploader.Promise,n=window.prompt(e,t);return null!=n&&fileUploader.trimStr(n).length>0?i.success(n):i.failure("Undefined or invalid user-supplied value."),i}},!0),fileUploader.extend(this._options,e,!0),!fileUploader.supportedFeatures.uploading||this._options.cors.expected&&!fileUploader.supportedFeatures.uploadCors?this._options.element.innerHTML="<div>"+this._options.messages.unsupportedBrowser+"</div>":(this._wrapCallbacks(),this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone),this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton),this._options.template=this._options.template.replace(/\{dropProcessingText\}/g,this._options.text.dropProcessing),this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{deleteButtonText\}/g,this._options.text.deleteButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,""),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._deleteRetryOrCancelClickHandler=this._bindDeleteRetryOrCancelClickEvent(),this._focusinEventSupported=!fileUploader.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent()),this._dnd=this._setupDragAndDrop(),this._options.paste.targetElement&&this._options.paste.promptForName&&this._setupPastePrompt(),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},fileUploader.extend(fileUploader.FineUploader.prototype,fileUploader.basePublicApi),fileUploader.extend(fileUploader.FineUploader.prototype,fileUploader.basePrivateApi),fileUploader.extend(fileUploader.FineUploader.prototype,fileUploader.uiPublicApi),fileUploader.extend(fileUploader.FineUploader.prototype,fileUploader.uiPrivateApi),fileUploader.AjaxRequestor=function(e){"use strict";function t(){return F.method.toUpperCase()}function i(){return fileUploader.indexOf(["GET","POST","HEAD"],t())>=0}function n(){var e=!1;return fileUploader.each(e,function(t,i){return fileUploader.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],i)<0?(e=!0,!1):void 0}),e}function o(e){return F.cors.expected&&void 0===e.withCredentials}function a(){var e;return window.XMLHttpRequest&&(e=new XMLHttpRequest,void 0===e.withCredentials&&(e=new XDomainRequest)),e}function r(e,t){var i=y[e].xhr;return i||t||(i=F.cors.expected?a():new XMLHttpRequest,y[e].xhr=i),i}function l(e){var t,i=fileUploader.indexOf(b,e),n=F.maxConnections;delete y[e],b.splice(i,1),b.length>=n&&n>i&&(t=b[n-1],p(t))}function s(e,i){var n=r(e),a=t(),s=i===!0;l(e),s?_(a+" request for "+e+" has failed","error"):o(n)||g(n.status)||(s=!0,_(a+" request for "+e+" has failed - response code "+n.status,"error")),F.onComplete(e,n,s)}function d(e){var t,i=y[e].onDemandParams,n=F.mandatedParams;return F.paramsStore.getParams&&(t=F.paramsStore.getParams(e)),i&&fileUploader.each(i,function(e,i){t=t||{},t[e]=i}),n&&fileUploader.each(n,function(e,i){t=t||{},t[e]=i}),t}function p(e){var i,n=r(e),a=t(),l=d(e),s=y[e].body;F.onSend(e),i=u(e,l),o(n)?(n.onload=f(e),n.onerror=h(e)):n.onreadystatechange=c(e),n.open(a,i,!0),F.cors.expected&&F.cors.sendCredentials&&!o(n)&&(n.withCredentials=!0),m(e),_("Sending "+a+" request for "+e),s?n.send(s):v||!l?n.send():n.send(l&&F.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?fileUploader.obj2url(l,""):l&&F.contentType.toLowerCase().indexOf("application/json")>=0?JSON.stringify(l):l)}function u(e,t){var i=F.endpointStore.getEndpoint(e),n=y[e].addToPath;return void 0!=n&&(i+="/"+n),v&&t?fileUploader.obj2url(t,i):i}function c(e){return function(){4===r(e).readyState&&s(e)}}function f(e){return function(){s(e)}}function h(e){return function(){s(e,!0)}}function m(e){var a=r(e),l=F.customHeaders,s=y[e].additionalHeaders||{},d=t(),p={};o(a)&&(F.cors.expected&&i()&&!n(l)||(a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Cache-Control","no-cache"))),!F.contentType||"POST"!==d&&"PUT"!==d||o(a)||a.setRequestHeader("Content-Type",F.contentType),o(a)||(fileUploader.extend(p,l),fileUploader.extend(p,s),fileUploader.each(p,function(e,t){a.setRequestHeader(e,t)}))}function U(e){var i=r(e,!0),n=t();return i?(o(i)?(i.onerror=null,i.onload=null):i.onreadystatechange=null,i.abort(),l(e),_("Cancelled "+n+" for "+e),F.onCancel(e),!0):!1}function g(e){return fileUploader.indexOf(F.successfulResponseCodes[t()],e)>=0}var _,v,b=[],y=[],F={validMethods:["POST"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},successfulResponseCodes:{DELETE:[200,202,204],POST:[200,204]},cors:{expected:!1,sendCredentials:!1},log:function(){},onSend:function(){},onComplete:function(){},onCancel:function(){}};if(fileUploader.extend(F,e),_=F.log,fileUploader.indexOf(F.validMethods,t())<0)throw new Error("'"+t()+"' is not a supported method for this type of request!");return v="GET"===t()||"DELETE"===t(),{send:function(e,t,i,n,o){y[e]={addToPath:t,onDemandParams:i,additionalHeaders:n,body:o};var a=b.push(e);a<=F.maxConnections&&p(e)},cancel:function(e){return U(e)},getMethod:function(){return t()}}},fileUploader.DeleteFileAjaxRequestor=function(e){"use strict";function t(){return"POST"===n.method.toUpperCase()?{_method:"DELETE"}:{}}var i,n={method:"DELETE",uuidParamName:"fileUploaderuuid",endpointStore:{},maxConnections:3,customHeaders:{},paramsStore:{},demoMode:!1,cors:{expected:!1,sendCredentials:!1},log:function(){},onDelete:function(){},onDeleteComplete:function(){}};return fileUploader.extend(n,e),i=new fileUploader.AjaxRequestor({validMethods:["POST","DELETE"],method:n.method,endpointStore:n.endpointStore,paramsStore:n.paramsStore,mandatedParams:t(),maxConnections:n.maxConnections,customHeaders:n.customHeaders,demoMode:n.demoMode,log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete,cors:n.cors}),{sendDelete:function(e,t,o){var a=o||{};n.log("Submitting delete file request for "+e),"DELETE"===i.getMethod()?i.send(e,t,a):(a[n.uuidParamName]=t,i.send(e,null,a))}}},fileUploader.WindowReceiveMessage=function(e){var t={log:function(){}},i={};return fileUploader.extend(t,e),{receiveMessage:function(e,t){var n=function(e){t(e.data)};window.postMessage?i[e]=fileUploader(window).attach("message",n):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(e){if(window.postMessage){var t=i[e];t&&t()}}}},fileUploader.UploadHandler=function(e,t){"use strict";function i(e){var t,i=fileUploader.indexOf(d,e),n=a.maxConnections;i>=0&&(d.splice(i,1),d.length>=n&&n>i&&(t=d[n-1],l.upload(t)))}function n(e){r("Cancelling "+e),a.paramsStore.remove(e),i(e)}function o(){var e=t?fileUploader[t]:fileUploader,n=fileUploader.supportedFeatures.ajaxUploading?"Xhr":"Form";l=new e["UploadHandler"+n](a,i,a.onUuidChanged,r)}var a,r,l,s,d=[];return a={debug:!1,forceMultipart:!0,paramsInBody:!1,paramsStore:{},endpointStore:{},filenameParam:"fileUploaderfilename",cors:{expected:!1,sendCredentials:!1},maxConnections:3,uuidParam:"fileUploaderuuid",totalFileSizeParam:"fileUploadertotalfilesize",chunking:{enabled:!1,partSize:2e6,paramNames:{partIndex:"fileUploaderpartindex",partByteOffset:"fileUploaderpartbyteoffset",chunkSize:"fileUploaderchunksize",totalParts:"fileUploadertotalparts",filename:"fileUploaderfilename"}},resume:{enabled:!1,id:null,cookiesExpireIn:7,paramNames:{resuming:"fileUploaderresume"}},log:function(){},onProgress:function(){},onComplete:function(){},onCancel:function(){},onUpload:function(){},onUploadChunk:function(){},onAutoRetry:function(){},onResume:function(){},onUuidChanged:function(){}},fileUploader.extend(a,e),r=a.log,s={add:function(e){return l.add(e)
},upload:function(e){var t=d.push(e);return t<=a.maxConnections?(l.upload(e),!0):!1},retry:function(e){var t=fileUploader.indexOf(d,e);return t>=0?l.upload(e,!0):this.upload(e)},cancel:function(e){var t=l.cancel(e);fileUploader.isPromise(t)?t.then(function(){n(e)}):t!==!1&&n(e)},cancelAll:function(){var e=this,t=[];fileUploader.extend(t,d),fileUploader.each(t,function(t,i){e.cancel(i)}),d=[]},getName:function(e){return l.getName(e)},setName:function(e,t){l.setName(e,t)},getSize:function(e){return l.getSize?l.getSize(e):void 0},getFile:function(e){return l.getFile?l.getFile(e):void 0},reset:function(){r("Resetting upload handler"),s.cancelAll(),d=[],l.reset()},expunge:function(e){return l.expunge(e)},getUuid:function(e){return l.getUuid(e)},setUuid:function(e,t){return l.setUuid(e,t)},isValid:function(e){return l.isValid(e)},getResumableFilesData:function(){return l.getResumableFilesData?l.getResumableFilesData():[]},getThirdPartyFileId:function(e){return l.getThirdPartyFileId&&s.isValid(e)?l.getThirdPartyFileId(e):void 0}},o(),s},fileUploader.UploadHandlerXhrApi=function(e,t,i,n,o,a,r){"use strict";function l(e,t,i){return e.slice?e.slice(t,i):e.mozSlice?e.mozSlice(t,i):e.webkitSlice?e.webkitSlice(t,i):void 0}var s;return fileUploader.extend(e,{createXhr:function(e){var i=new XMLHttpRequest;return t[e].xhr=i,i},getTotalChunks:function(e){if(i){var t=s.getSize(e),n=i.partSize;return Math.ceil(t/n)}},getChunkData:function(t,n){var o=i.partSize,a=s.getSize(t),r=s.getFile(t),d=o*n,p=d+o>=a?a:d+o,u=e.getTotalChunks(t);return{part:n,start:d,end:p,count:u,blob:l(r,d,p),size:p-d}},getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}}}),s={add:function(e){var i,n=fileUploader.getUniqueId();if(fileUploader.isFile(e))i=t.push({file:e})-1;else{if(!fileUploader.isBlob(e.blob))throw new Error("Passed obj in not a File or BlobData (in fileUploader.UploadHandlerXhr)");i=t.push({blobData:e})-1}return t[i].uuid=n,i},getName:function(e){if(s.isValid(e)){var i=t[e].file,n=t[e].blobData,o=t[e].newName;return void 0!==o?o:i?null!==i.fileName&&void 0!==i.fileName?i.fileName:i.name:n.name}r(e+" is not a valid item ID.","error")},setName:function(e,i){t[e].newName=i},getSize:function(e){var i=t[e].file||t[e].blobData.blob;return fileUploader.isFileOrInput(i)&&null!=i.fileSize?i.fileSize:i.size},getFile:function(e){return t[e]?t[e].file||t[e].blobData.blob:void 0},isValid:function(e){return void 0!==t[e]},reset:function(){t.length=0},expunge:function(e){var i=t[e].xhr;i&&(i.onreadystatechange=null,i.abort()),delete t[e]},getUuid:function(e){return t[e].uuid},upload:function(e,t){return n(e,t)},cancel:function(e){var t=o(e,s.getName(e));return fileUploader.isPromise(t)?t.then(function(){s.expunge(e)}):t!==!1?(s.expunge(e),!0):!1},setUuid:function(e,i){r("Server requested UUID change from '"+t[e].uuid+"' to '"+i+"'"),t[e].uuid=i,a(e,i)}}},fileUploader.UploadHandlerFormApi=function(e,t,i,n,o,a,r){"use strict";function l(n){delete m[n],delete t[n],i&&(clearTimeout(U[n]),delete U[n],f.stopReceivingMessages(n));var o=document.getElementById(e.getIframeName(n));o&&(o.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;"),fileUploader(o).remove())}function s(i,n){var o=i.id,a=p(o),l=t[a].uuid;h[l]=n,m[a]=fileUploader(i).attach("load",function(){t[a].input&&(r("Received iframe load event for CORS upload request (iframe name "+o+")"),U[o]=setTimeout(function(){var e="No valid message received from loaded iframe for iframe name "+o;r(e,"error"),n({error:e})},1e3))}),f.receiveMessage(o,function(t){r("Received the following window message: '"+t+"'");var i,n=p(o),a=e.parseJsonResponse(n,t),l=a.uuid;l&&h[l]?(r("Handling response for iframe name "+o),clearTimeout(U[o]),delete U[o],e.detachLoadEvent(o),i=h[l],delete h[l],f.stopReceivingMessages(o),i(a)):l||r("'"+t+"' does not contain a UUID - ignoring.")})}function d(e){var t=fileUploader.toElement('<iframe src="javascript:false;" name="'+e+'" />');return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t}function p(e){return e.split("_")[0]}var u,c=fileUploader.getUniqueId(),f=new fileUploader.WindowReceiveMessage({log:r}),h={},m={},U={};return fileUploader.extend(e,{getIframeName:function(e){return e+"_"+c},createIframe:function(t){var i=e.getIframeName(t);return d(i)},parseJsonResponse:function(e,t){var i;try{i=fileUploader.parseJson(t),void 0!==i.newUuid&&u.setUuid(e,i.newUuid)}catch(n){r("Error when attempting to parse iframe upload response ("+n.message+")","error"),i={}}return i},initFormForUpload:function(e){var t=e.method,i=e.endpoint,n=e.params,o=e.paramsInBody,a=e.targetName,r=fileUploader.toElement('<form method="'+t+'" enctype="multipart/form-data"></form>'),l=i;return o?fileUploader.obj2Inputs(n,r):l=fileUploader.obj2url(n,i),r.setAttribute("action",l),r.setAttribute("target",a),r.style.display="none",document.body.appendChild(r),r},attachLoadEvent:function(e,t){var n;i?s(e,t):m[e.id]=fileUploader(e).attach("load",function(){if(r("Received response for "+e.id),e.parentNode){try{if(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML)return}catch(i){r("Error when attempting to access iframe during handling of upload response ("+i.message+")","error"),n={success:!1}}t(n)}})},detachLoadEvent:function(e){void 0!==m[e]&&(m[e](),delete m[e])}}),u={add:function(e){var i=t.push({input:e})-1;return e.setAttribute("name",n),t[i].uuid=fileUploader.getUniqueId(),e.parentNode&&fileUploader(e).remove(),i},getName:function(e){return void 0!==t[e].newName?t[e].newName:u.isValid(e)?t[e].input.value.replace(/.*(\/|\\)/,""):void r(e+" is not a valid item ID.","error")},setName:function(e,i){t[e].newName=i},isValid:function(e){return void 0!==t[e]&&void 0!==t[e].input},reset:function(){t.length=0},expunge:function(e){return l(e)},getUuid:function(e){return t[e].uuid},cancel:function(e){var t=o(e,u.getName(e));return fileUploader.isPromise(t)?t.then(function(){u.expunge(e)}):t!==!1?(u.expunge(e),!0):!1},upload:function(){},setUuid:function(e,i){r("Server requested UUID change from '"+t[e].uuid+"' to '"+i+"'"),t[e].uuid=i,a(e,i)}}},fileUploader.UiEventHandler=function(e,t){"use strict";function i(e){n.attach(e,o.eventType,function(e){e=e||window.event;var t=e.target||e.srcElement;o.onHandled(t,e)})}var n=new fileUploader.DisposeSupport,o={eventType:"click",attachTo:null,onHandled:function(){}},a={addHandler:function(e){i(e)},dispose:function(){n.dispose()}};return fileUploader.extend(t,{getItemFromEventTarget:function(e){for(var t=e.parentNode;void 0===t.fileUploaderFileId;)t=t.parentNode;return t},getFileIdFromItem:function(e){return e.fileUploaderFileId},getDisposeSupport:function(){return n}}),fileUploader.extend(o,e),o.attachTo&&i(o.attachTo),a},fileUploader.DeleteRetryOrCancelClickHandler=function(e){"use strict";function t(e,t){if(fileUploader(e).hasClass(o.classes.cancel)||fileUploader(e).hasClass(o.classes.retry)||fileUploader(e).hasClass(o.classes.deleteButton)){var a=n.getItemFromEventTarget(e),r=n.getFileIdFromItem(a);fileUploader.preventDefault(t),o.log(fileUploader.format("Detected valid cancel, retry, or delete click event on file '{}', ID: {}.",o.onGetName(r),r)),i(e,r)}}function i(e,t){fileUploader(e).hasClass(o.classes.deleteButton)?o.onDeleteFile(t):fileUploader(e).hasClass(o.classes.cancel)?o.onCancel(t):o.onRetry(t)}var n={},o={listElement:document,log:function(){},classes:{cancel:"fileUploader-upload-cancel",deleteButton:"fileUploader-upload-delete",retry:"fileUploader-upload-retry"},onDeleteFile:function(){},onCancel:function(){},onRetry:function(){},onGetName:function(){}};fileUploader.extend(o,e),o.eventType="click",o.onHandled=t,o.attachTo=o.listElement,fileUploader.extend(this,new fileUploader.UiEventHandler(o,n))},fileUploader.FilenameEditHandler=function(e,t){"use strict";function i(e){var t=s.onGetName(e),i=t.lastIndexOf(".");return i>0&&(t=t.substr(0,i)),t}function n(e){var t=s.onGetName(e);return fileUploader.getExtension(t)}function o(e,t){var i,o=e.value;void 0!==o&&fileUploader.trimStr(o).length>0&&(i=n(t),void 0!==i&&(o=o+"."+i),s.onSetName(t,o)),s.onEditingStatusChange(t,!1)}function a(e,i){t.getDisposeSupport().attach(e,"blur",function(){o(e,i)})}function r(e,i){t.getDisposeSupport().attach(e,"keyup",function(t){var n=t.keyCode||t.which;13===n&&o(e,i)})}var l,s={listElement:null,log:function(){},classes:{file:"fileUploader-upload-file"},onGetUploadStatus:function(){},onGetName:function(){},onSetName:function(){},onGetInput:function(){},onEditingStatusChange:function(){}};return fileUploader.extend(s,e),s.attachTo=s.listElement,l=fileUploader.extend(this,new fileUploader.UiEventHandler(s,t)),fileUploader.extend(t,{handleFilenameEdit:function(e,t,n,o){var l=s.onGetInput(n);s.onEditingStatusChange(e,!0),l.value=i(e),o&&l.focus(),a(l,e),r(l,e)}}),l},fileUploader.FilenameClickHandler=function(e){"use strict";function t(e,t){if(fileUploader(e).hasClass(n.classes.file)||fileUploader(e).hasClass(n.classes.editNameIcon)){var o=i.getItemFromEventTarget(e),a=i.getFileIdFromItem(o),r=n.onGetUploadStatus(a);r===fileUploader.status.SUBMITTED&&(n.log(fileUploader.format("Detected valid filename click event on file '{}', ID: {}.",n.onGetName(a),a)),fileUploader.preventDefault(t),i.handleFilenameEdit(a,e,o,!0))}}var i={},n={log:function(){},classes:{file:"fileUploader-upload-file",editNameIcon:"fileUploader-edit-filename-icon"},onGetUploadStatus:function(){},onGetName:function(){}};return fileUploader.extend(n,e),n.eventType="click",n.onHandled=t,fileUploader.extend(this,new fileUploader.FilenameEditHandler(n,i))},fileUploader.FilenameInputFocusInHandler=function(e,t){"use strict";function i(e){if(fileUploader(e).hasClass(n.classes.editFilenameInput)){var i=t.getItemFromEventTarget(e),o=t.getFileIdFromItem(i),a=n.onGetUploadStatus(o);a===fileUploader.status.SUBMITTED&&(n.log(fileUploader.format("Detected valid filename input focus event on file '{}', ID: {}.",n.onGetName(o),o)),t.handleFilenameEdit(o,e,i))}}var n={listElement:null,classes:{editFilenameInput:"fileUploader-edit-filename"},onGetUploadStatus:function(){},log:function(){}};return t||(t={}),n.eventType="focusin",n.onHandled=i,fileUploader.extend(n,e),fileUploader.extend(this,new fileUploader.FilenameEditHandler(n,t))},fileUploader.FilenameInputFocusHandler=function(e){"use strict";return e.eventType="focus",e.attachTo=null,fileUploader.extend(this,new fileUploader.FilenameInputFocusInHandler(e,{}))},function(e){"use strict";function t(e){if(e){var t=l(e),n=i(t);o(n),r(t,n)}return p}function i(e){var t=a("uploaderType"),i=a("endpointType");return t?(t=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase(),i?new fileUploader[i]["FineUploader"+t](e):new fileUploader["FineUploader"+t](e)):i?new fileUploader[i].FineUploader(e):new fileUploader.FineUploader(e)}function n(e,t){var i=p.data("fineuploader");return t?(void 0===i&&(i={}),i[e]=t,p.data("fineuploader",i),void 0):void 0===i?null:i[e]}function o(e){return n("uploader",e)}function a(e,t){return n(e,t)}function r(t,i){var n=t.callbacks={};e.each(i._options.callbacks,function(e){var t,i;t=/^on(\w+)/.exec(e)[1],t=t.substring(0,1).toLowerCase()+t.substring(1),i=p,n[e]=function(){var e=Array.prototype.slice.call(arguments);return i.triggerHandler(t,e)}}),i._options.callbacks=n}function l(t,i){var n,o;return n=void 0===i?"basic"!==t.uploaderType?{element:p[0]}:{}:i,e.each(t,function(t,i){e.inArray(t,u)>=0?a(t,i):i instanceof e?n[t]=i[0]:e.isPlainObject(i)?(n[t]={},l(i,n[t])):e.isArray(i)?(o=[],e.each(i,function(t,i){i instanceof e?e.merge(o,i):o.push(i)}),n[t]=o):n[t]=i}),void 0===i?n:void 0}function s(t){return"string"===e.type(t)&&!t.match(/^_/)&&void 0!==o()[t]}function d(t){var i,n=[],a=Array.prototype.slice.call(arguments,1);return l(a,n),i=o()[t].apply(o(),n),"object"!=typeof i||1!==i.nodeType&&9!==i.nodeType||!i.cloneNode||(i=e(i)),i}var p,u=["uploaderType","endpointType"];e.fn.fineUploader=function(i){var n=this,a=arguments,r=[];return this.each(function(l,u){if(p=e(u),o()&&s(i)){if(r.push(d.apply(n,a)),1===n.length)return!1}else"object"!=typeof i&&i?e.error("Method "+i+" does not exist on jQuery.fineUploader"):t.apply(n,a)}),1===r.length?r[0]:r.length>1?r:this}}(jQuery),function(e){"use strict";function t(e){e||(e={}),e.dropZoneElements=[s];var t=a(e);return o(t),n(new fileUploader.DragAndDrop(t)),s}function i(e,t){var i=s.data(d);return t?(void 0===i&&(i={}),i[e]=t,s.data(d,i),void 0):void 0===i?null:i[e]}function n(e){return i("dndInstance",e)}function o(t){{var i=t.callbacks={};new fileUploader.FineUploaderBasic}e.each(new fileUploader.DragAndDrop.callbacks,function(e){var t,n=e;t=s,i[e]=function(){var e=Array.prototype.slice.call(arguments),i=t.triggerHandler(n,e);return i}})}function a(t,i){var n,o;return n=void 0===i?{}:i,e.each(t,function(t,i){i instanceof e?n[t]=i[0]:e.isPlainObject(i)?(n[t]={},a(i,n[t])):e.isArray(i)?(o=[],e.each(i,function(t,i){i instanceof e?e.merge(o,i):o.push(i)}),n[t]=o):n[t]=i}),void 0===i?n:void 0}function r(t){return"string"===e.type(t)&&"dispose"===t&&void 0!==n()[t]}function l(e){var t=[],i=Array.prototype.slice.call(arguments,1);return a(i,t),n()[e].apply(n(),t)}var s,d="fineUploaderDnd";e.fn.fineUploaderDnd=function(i){var o=this,a=arguments,d=[];return this.each(function(p,u){if(s=e(u),n()&&r(i)){if(d.push(l.apply(o,a)),1===o.length)return!1}else"object"!=typeof i&&i?e.error("Method "+i+" does not exist in Fine Uploader's DnD module."):t.apply(o,a)}),1===d.length?d[0]:d.length>1?d:this}}(jQuery),fileUploader.UploadHandlerForm=function(e,t,i,n){"use strict";function o(e,t){var i;try{var n=t.contentDocument||t.contentWindow.document,o=n.body.innerHTML;d("converting iframe's innerHTML to JSON"),d("innerHTML = "+o),o&&o.match(/^<pre/i)&&(o=n.body.firstChild.firstChild.nodeValue),i=p.parseJsonResponse(e,o)}catch(a){d("Error when attempting to parse form upload response ("+a.message+")","error"),i={success:!1}}return i}function a(t,i){var n=e.paramsStore.getParams(t),o=e.demoMode?"GET":"POST",a=e.endpointStore.getEndpoint(t),r=l[t].newName;return n[e.uuidParam]=l[t].uuid,r&&(n[e.filenameParam]=r),p.initFormForUpload({method:o,endpoint:a,params:n,paramsInBody:e.paramsInBody,targetName:i.name})}var r,l=[],s=t,d=n,p={};return r=new fileUploader.UploadHandlerFormApi(p,l,e.cors.expected,e.inputName,e.onCancel,i,d),fileUploader.extend(r,{upload:function(t){var i,n=l[t].input,u=r.getName(t),c=p.createIframe(t);if(!n)throw new Error("file with passed id was not added, or already uploaded or cancelled");e.onUpload(t,r.getName(t)),i=a(t,c),i.appendChild(n),p.attachLoadEvent(c,function(i){d("iframe loaded");var n=i?i:o(t,c);p.detachLoadEvent(t),e.cors.expected||fileUploader(c).remove(),(n.success||!e.onAutoRetry(t,u,n))&&(e.onComplete(t,u,n),s(t))}),d("Sending upload request for "+t),i.submit(),fileUploader(i).remove()}})},fileUploader.UploadHandlerXhr=function(e,t,i,n){"use strict";function o(t,i,n){var o=T.getSize(t),a=T.getName(t);i[e.chunking.paramNames.partIndex]=n.part,i[e.chunking.paramNames.partByteOffset]=n.start,i[e.chunking.paramNames.chunkSize]=n.size,i[e.chunking.paramNames.totalParts]=n.count,i[e.totalFileSizeParam]=o,L&&(i[e.filenameParam]=a)}function a(t){t[e.resume.paramNames.resuming]=!0}function r(t,i,n,o){var a=new FormData,r=e.demoMode?"GET":"POST",l=e.endpointStore.getEndpoint(o),s=l,d=T.getName(o),p=T.getSize(o),u=A[o].blobData,c=A[o].newName;return t[e.uuidParam]=A[o].uuid,L&&(t[e.totalFileSizeParam]=p,u&&(t[e.filenameParam]=u.name)),void 0!==c&&(t[e.filenameParam]=c),e.paramsInBody||(L||(t[e.inputName]=c||d),s=fileUploader.obj2url(t,l)),i.open(r,s,!0),e.cors.expected&&e.cors.sendCredentials&&(i.withCredentials=!0),L?(e.paramsInBody&&fileUploader.obj2FormData(t,a),a.append(e.inputName,n),a):n}function l(t,i){var n=e.customHeaders,o=A[t].file||A[t].blobData.blob;i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Cache-Control","no-cache"),L||(i.setRequestHeader("Content-Type","application/octet-stream"),i.setRequestHeader("X-Mime-Type",o.type)),fileUploader.each(n,function(e,t){i.setRequestHeader(e,t)})}function s(t,i,n){var o=T.getName(t),a=T.getSize(t);A[t].attemptingResume=!1,e.onProgress(t,o,a,a),e.onComplete(t,o,i,n),A[t]&&delete A[t].xhr,R(t)}function d(t){var i,n,s=A[t].remainingChunkIdxs[0],d=H.getChunkData(t,s),u=H.createXhr(t),c=T.getSize(t),f=T.getName(t);void 0===A[t].loaded&&(A[t].loaded=0),O&&A[t].file&&b(t,d),u.onreadystatechange=v(t,u),u.upload.onprogress=function(i){if(i.lengthComputable){var n=i.loaded+A[t].loaded,o=p(t,s,i.total);e.onProgress(t,f,n,o)}},e.onUploadChunk(t,f,H.getChunkDataForCallback(d)),n=e.paramsStore.getParams(t),o(t,n,d),A[t].attemptingResume&&a(n),i=r(n,u,d.blob,t),l(t,u),P("Sending chunked upload request for item "+t+": bytes "+(d.start+1)+"-"+d.end+" of "+c),u.send(i)}function p(e,t,i){var n=H.getChunkData(e,t),o=n.size,a=i-o,r=T.getSize(e),l=n.count,s=A[e].initialRequestOverhead,d=a-s;return A[e].lastRequestOverhead=a,0===t?(A[e].lastChunkIdxProgress=0,A[e].initialRequestOverhead=a,A[e].estTotalRequestsSize=r+l*a):A[e].lastChunkIdxProgress!==t&&(A[e].lastChunkIdxProgress=t,A[e].estTotalRequestsSize+=d),A[e].estTotalRequestsSize}function u(e){return L?A[e].lastRequestOverhead:0}function c(e,t,i){var n=A[e].remainingChunkIdxs.shift(),o=H.getChunkData(e,n);A[e].attemptingResume=!1,A[e].loaded+=o.size+u(e),A[e].remainingChunkIdxs.length>0?d(e):(O&&y(e),s(e,t,i))}function f(e,t){return 200!==e.status||!t.success||t.reset}function h(e,t){var i;try{P(fileUploader.format("Received response status {} with body: {}",t.status,t.responseText)),i=fileUploader.parseJson(t.responseText),void 0!==i.newUuid&&T.setUuid(e,i.newUuid)}catch(n){P("Error when attempting to parse xhr response text ("+n.message+")","error"),i={}}return i}function m(e){P("Server has ordered chunking effort to be restarted on next attempt for item ID "+e,"error"),O&&(y(e),A[e].attemptingResume=!1),A[e].remainingChunkIdxs=[],delete A[e].loaded,delete A[e].estTotalRequestsSize,delete A[e].initialRequestOverhead}function U(e){A[e].attemptingResume=!1,P("Server has declared that it cannot handle resume for item ID "+e+" - starting from the first chunk","error"),m(e),T.upload(e,!0)}function g(t,i,n){var o=T.getName(t);e.onAutoRetry(t,o,i,n)||s(t,i,n)}function _(e,t){var i;A[e]&&(P("xhr - server response received for "+e),P("responseText = "+t.responseText),i=h(e,t),f(t,i)?(i.reset&&m(e),A[e].attemptingResume&&i.reset?U(e):g(e,i,t)):B?c(e,i,t):s(e,i,t))}function v(e,t){return function(){4===t.readyState&&_(e,t)}}function b(t,i){var n=T.getUuid(t),o=A[t].loaded,a=A[t].initialRequestOverhead,r=A[t].estTotalRequestsSize,l=C(t),s=n+N+i.part+N+o+N+a+N+r,d=e.resume.cookiesExpireIn;fileUploader.setCookie(l,s,d)}function y(e){if(A[e].file){var t=C(e);fileUploader.deleteCookie(t)}}function F(e){var t,i,n,o,a,r,l=fileUploader.getCookie(C(e)),s=T.getName(e);if(l){if(t=l.split(N),5===t.length)return i=t[0],n=parseInt(t[1],10),o=parseInt(t[2],10),a=parseInt(t[3],10),r=parseInt(t[4],10),{uuid:i,part:n,lastByteSent:o,initialRequestOverhead:a,estTotalRequestsSize:r};P("Ignoring previously stored resume/chunk cookie for "+s+" - old cookie format","warn")}}function C(t){var i,n=T.getName(t),o=T.getSize(t),a=e.chunking.partSize;return i="fileUploaderfilechunk"+N+encodeURIComponent(n)+N+o+N+a,void 0!==z&&(i+=N+z),i}function x(){return null===e.resume.id||void 0===e.resume.id||fileUploader.isFunction(e.resume.id)||fileUploader.isObject(e.resume.id)?void 0:e.resume.id}function S(e,t){var i;for(i=H.getTotalChunks(e)-1;i>=t;i-=1)A[e].remainingChunkIdxs.unshift(i);d(e)}function D(e,t,i,n){i=n.part,A[e].loaded=n.lastByteSent,A[e].estTotalRequestsSize=n.estTotalRequestsSize,A[e].initialRequestOverhead=n.initialRequestOverhead,A[e].attemptingResume=!0,P("Resuming "+t+" at partition index "+i),S(e,i)}function E(t,i,n){var o,a=T.getName(t),r=H.getChunkData(t,i.part);o=e.onResume(t,a,H.getChunkDataForCallback(r)),fileUploader.isPromise(o)?(P("Waiting for onResume promise to be fulfilled for "+t),o.then(function(){D(t,a,n,i)},function(){P("onResume promise fulfilled - failure indicated.  Will not resume."),S(t,n)})):o!==!1?D(t,a,n,i):(P("onResume callback returned false.  Will not resume."),S(t,n))}function I(e,t){var i,n=0;A[e].remainingChunkIdxs&&0!==A[e].remainingChunkIdxs.length?d(e):(A[e].remainingChunkIdxs=[],O&&!t&&A[e].file?(i=F(e),i?E(e,i,n):S(e,n)):S(e,n))}function w(t){var i,n,o,a=A[t].file||A[t].blobData.blob,s=T.getName(t);A[t].loaded=0,i=H.createXhr(t),i.upload.onprogress=function(i){i.lengthComputable&&(A[t].loaded=i.loaded,e.onProgress(t,s,i.loaded,i.total))},i.onreadystatechange=v(t,i),n=e.paramsStore.getParams(t),o=r(n,i,a,t),l(t,i),P("Sending upload request for "+t),i.send(o)}function k(t,i){var n=T.getName(t);T.isValid(t)&&(e.onUpload(t,n),B?I(t,i):w(t))}var T,R=t,P=n,A=[],N="|",B=e.chunking.enabled&&fileUploader.supportedFeatures.chunking,O=e.resume.enabled&&B&&fileUploader.supportedFeatures.resume,z=x(),L=e.forceMultipart||e.paramsInBody,H={};return T=new fileUploader.UploadHandlerXhrApi(H,A,B?e.chunking:null,k,e.onCancel,i,P),fileUploader.override(T,function(t){return{add:function(e){var i,n=t.add(e);return O&&(i=F(n),i&&(A[n].uuid=i.uuid)),n},getResumableFilesData:function(){var t=[],i=[];return B&&O?(t=fileUploader.getCookieNames(void 0===z?new RegExp("^fileUploaderfilechunk\\"+N+".+\\"+N+"\\d+\\"+N+e.chunking.partSize+"="):new RegExp("^fileUploaderfilechunk\\"+N+".+\\"+N+"\\d+\\"+N+e.chunking.partSize+"\\"+N+z+"=")),fileUploader.each(t,function(e,t){var n=t.split(N),o=fileUploader.getCookie(t).split(N);i.push({name:decodeURIComponent(n[1]),size:n[2],uuid:o[0],partIdx:o[1]})}),i):[]},expunge:function(e){O&&y(e),t.expunge(e)}}}),T};